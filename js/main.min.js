!function(e){"use strict";function t(e){return new RegExp("(^|\\s+)"+e+"(\\s+|$)")}function a(e,t){var a=i(e,t)?o:n;a(e,t)}var i,n,o;"classList"in document.documentElement?(i=function(e,t){return e.classList.contains(t)},n=function(e,t){e.classList.add(t)},o=function(e,t){e.classList.remove(t)}):(i=function(e,a){return t(a).test(e.className)},n=function(e,t){i(e,t)||(e.className=e.className+" "+t)},o=function(e,a){e.className=e.className.replace(t(a)," ")});var s={hasClass:i,addClass:n,removeClass:o,toggleClass:a,has:i,add:n,remove:o,toggle:a};"function"==typeof define&&define.amd?define(s):e.classie=s}(window),String.prototype.repeat=function(e){return new Array(Math.round(e)+1).join(this)},function(e){e.fn.addSliderSegments=function(){return this.each(function(){var t=e(this),a=t.slider("option"),i=(a.max-a.min)/a.step,n=a.orientation;if("vertical"===n){var o,s="";for(o=1;i-1>=o;o+1)s+='<div class="ui-slider-segment" style="top:'+100/i*o+'%;"></div>';t.prepend(s)}else{var r=100/i+"%",l='<div class="ui-slider-segment" style="margin-left: '+r+';"></div>';t.prepend(l.repeat(i-1))}})},jQuery(function(e){var t=e("#slider"),a=e("#walk-slider"),i=15,n=100;e(document).on("click",'a[href="#fakelink"]',function(e){e.preventDefault()}),e('[data-toggle="select"]').length&&e('[data-toggle="select"]').select2({minimumResultsForSearch:-1}),t.length>0&&t.slider({min:1,max:4,value:2,orientation:"horizontal",range:"min",slide:function(e,a){var n=a.value*i;t.find(".ui-slider-value:last").text(n+" 分鐘").data("slidervalue",n)}}).addSliderSegments(t.slider("option").max),e(".btn-group").on("click","a",function(){e(this).siblings().removeClass("active").end().addClass("active")}),a.length>0&&a.slider({min:2,max:9,value:6,orientation:"horizontal",range:"min",slide:function(e,t){var i=t.value*n;a.find(".ui-slider-value:last").text(i+" 公尺").data("slidervalue",i)}}).addSliderSegments(a.slider("option").max),e('[data-toggle="checkbox"]').radiocheck(),e('[data-toggle="radio"]').radiocheck(),e('[data-toggle="switch"]').length&&e('[data-toggle="switch"]').bootstrapSwitch()})}(jQuery),function(e){var t=e("#slider"),a=e("#walk-slider"),i=(e("#article-conveyance"),e("#wrapper")),n={walkDistance:600,tripTime:30,startTime:"0800",weekType:1,transitType:"BYTM",result:{area:"0",level:"A"}};e(function(e){classie.removeClass(document.getElementById("wrapper"),"hidden"),FastClick.attach(document.body),window.alert=swal,e(".iui-overlay").find("button").on("click",function(){s(),GMap.initialize(function(){e(window).resize(function(e){google.maps.event.trigger(GMap.map,"resize")}),google.maps.event.addListenerOnce(GMap.map,"idle",function(){n.latitude=GMap.centerMarker.getPosition().lat(),n.longitude=GMap.centerMarker.getPosition().lng()}),google.maps.event.addListenerOnce(GMap.map,"idle",function(){e("#overlay").slideUp("slow"),classie.removeClass(document.getElementById("businfo-panal"),"hidden"),classie.removeClass(document.getElementById("menu-toggle"),"hidden")}),google.maps.event.addListener(GMap.centerMarker,"dragend",function(e){n.latitude=GMap.centerMarker.getPosition().lat(),n.longitude=GMap.centerMarker.getPosition().lng(),TripTaipeiService.query(n,o)});var s=e("#weekly").find(".btn").on("click",function(){n.weekType=e(this).data("index"),TripTaipeiService.query(n,o)});n.weekType=(new Date).getDay(),e(s[n.weekType-1]).addClass("active"),i.find('#article-conveyance [data-toggle="checkbox"]').on("change",function(t){var a="";e("#bus").prop("checked")&&(a+="B"),e("#mrt").prop("checked")&&(a+="M"),e("#train").prop("checked")&&(a+="T"),e("#youbike").prop("checked")&&(a+="Y"),""===a?(window.alert("請至少選擇一種交通工具"),i.find('#article-conveyance [data-toggle="checkbox"]').prop("checked",!0),n.transitType="BYTM"):(n.transitType=a,TripTaipeiService.query(n,o))}),a.on("slidestop",function(e,t){n.walkDistance=a.find(".ui-slider-value:last").data("slidervalue"),GMap.centerCircle.setOptions({radius:n.walkDistance}),TripTaipeiService.query(n,o)}),t.on("slidestop",function(e,a){n.tripTime=t.find(".ui-slider-value:last").data("slidervalue"),TripTaipeiService.query(n,o)})})}),e('[data-toggle="switch"]').on("switchChange.bootstrapSwitch",function(t,a){var i=e(t.target);GMap.checkStop(i.prop("value"),a),GMap.level[i.val()]=a}),e("#menu-close").click(function(t){t.preventDefault(),e("#sidebar-wrapper").toggleClass("active")}),e("#menu-toggle").click(function(t){t.preventDefault(),e("#sidebar-wrapper").toggleClass("active")}),e("#timepicker").timepicker({defaultTime:"08:00 AM",disableFocus:!1,showMeridian:!1}).on("hide.timepicker",function(e){var t=e.time.value;e.time.hours<10&&(t="0"+t),n.startTime=t.replace(":",""),TripTaipeiService.query(n,o)})});var o=function(t){e("#service-area").text(t.result.area),e("#service-level").text(t.result.level)},s=function(){var e=document.getElementById("bgvid");e.pause(),e.addEventListener("ended",function(){e.pause(),e.classList.add("stopfade")})}}(jQuery),function(){"use strict";function e(e,t){this.controlUI=document.createElement("div"),this.controlUI.style.backgroundColor="#fff",this.controlUI.style.border="2px solid #fff",this.controlUI.style.borderRadius="3px",this.controlUI.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",this.controlUI.style.cursor="pointer",this.controlUI.style.marginLeft="10px",this.controlUI.style.textAlign="center",this.controlUI.title="顯示您的位置",this.controlText=document.createElement("div"),this.controlText.style.color="rgb(25,25,25)",this.controlText.style.fontSize="14px",this.controlText.style.lineHeight="22px",this.controlText.style.paddingLeft="5px",this.controlText.style.paddingRight="5px",this.controlText.innerHTML='<span class="glyphicon glyphicon-screenshot" aria-hidden="true"></span>',this.controlUI.appendChild(this.controlText),e.appendChild(this.controlUI),this.controlUI.addEventListener("click",function(){p()})}var t=[],a=new google.maps.Data,i=new google.maps.Data,n=new google.maps.Data,o=new google.maps.Data,s={map:{},centerMarker:{},centerCircle:{},infowindow:{},level:{B:!0,Y:!0,T:!0,M:!0}};s.initialize=function(t){var a=new google.maps.LatLng(25.046281027241395,121.51760685634758),i={zoom:13,disableDefaultUI:!0,scrollwheel:!1,center:a,mapTypeId:google.maps.MapTypeId.ROADMAP,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_CENTER},styles:[{featureType:"administrative",elementType:"all",stylers:[{visibility:"on"},{lightness:33}]},{featureType:"administrative",elementType:"labels",stylers:[{saturation:"-100"}]},{featureType:"administrative",elementType:"labels.text",stylers:[{gamma:"0.75"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.fill",stylers:[{lightness:"-37"}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#f9f9f9"}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{saturation:"-100"},{lightness:"40"},{visibility:"off"}]},{featureType:"landscape.natural",elementType:"labels.text.fill",stylers:[{saturation:"-100"},{lightness:"-37"}]},{featureType:"landscape.natural",elementType:"labels.text.stroke",stylers:[{saturation:"-100"},{lightness:"100"},{weight:"2"}]},{featureType:"landscape.natural",elementType:"labels.icon",stylers:[{saturation:"-100"}]},{featureType:"poi",elementType:"geometry",stylers:[{saturation:"-100"},{lightness:"80"}]},{featureType:"poi",elementType:"labels",stylers:[{saturation:"-100"},{lightness:"0"}]},{featureType:"poi.attraction",elementType:"geometry",stylers:[{lightness:"-4"},{saturation:"-100"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#c5dac6"},{visibility:"on"},{saturation:"-95"},{lightness:"62"}]},{featureType:"poi.park",elementType:"labels",stylers:[{visibility:"on"},{lightness:20}]},{featureType:"road",elementType:"all",stylers:[{lightness:20}]},{featureType:"road",elementType:"labels",stylers:[{saturation:"-100"},{gamma:"1.00"}]},{featureType:"road",elementType:"labels.text",stylers:[{gamma:"0.50"}]},{featureType:"road",elementType:"labels.icon",stylers:[{saturation:"-100"},{gamma:"0.50"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#c5c6c6"},{saturation:"-100"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{lightness:"-13"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{lightness:"0"},{gamma:"1.09"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#e4d7c6"},{saturation:"-100"},{lightness:"47"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{lightness:"-12"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{saturation:"-100"}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#fbfaf7"},{lightness:"77"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{lightness:"-5"},{saturation:"-100"}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{saturation:"-100"},{lightness:"-15"}]},{featureType:"transit.station.airport",elementType:"geometry",stylers:[{lightness:"47"},{saturation:"-100"}]},{featureType:"water",elementType:"all",stylers:[{visibility:"on"},{color:"#acbcc9"}]},{featureType:"water",elementType:"geometry",stylers:[{saturation:"53"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{lightness:"-42"},{saturation:"17"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{lightness:"61"}]}]};this.map=new google.maps.Map(document.getElementById("map-canvas"),i),this.centerMarker=new google.maps.Marker({draggable:!0,position:a,map:this.map,icon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaGVpZ2h0PSIyNCIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgLTEwMjguNCkiPjxwYXRoIGQ9Im0xMi4wMzEgMTAzMC40Yy0zLjg2NTcgMC02Ljk5OTggMy4xLTYuOTk5OCA3IDAgMS4zIDAuNDAxNyAyLjYgMS4wOTM4IDMuNyAwLjAzMzQgMC4xIDAuMDU5IDAuMSAwLjA5MzggMC4ybDQuMzQzMiA4YzAuMjA0IDAuNiAwLjc4MiAxLjEgMS40MzggMS4xczEuMjAyLTAuNSAxLjQwNi0xLjFsNC44NDQtOC43YzAuNDk5LTEgMC43ODEtMi4xIDAuNzgxLTMuMiAwLTMuOS0zLjEzNC03LTctN3ptLTAuMDMxIDMuOWMxLjkzMyAwIDMuNSAxLjYgMy41IDMuNSAwIDItMS41NjcgMy41LTMuNSAzLjVzLTMuNS0xLjUtMy41LTMuNWMwLTEuOSAxLjU2Ny0zLjUgMy41LTMuNXoiIGZpbGw9IiNjMDM5MmIiLz48cGF0aCBkPSJtMTIuMDMxIDEuMDMxMmMtMy44NjU3IDAtNi45OTk4IDMuMTM0LTYuOTk5OCA3IDAgMS4zODMgMC40MDE3IDIuNjY0OCAxLjA5MzggMy43NDk4IDAuMDMzNCAwLjA1MyAwLjA1OSAwLjEwNSAwLjA5MzggMC4xNTdsNC4zNDMyIDguMDYyYzAuMjA0IDAuNTg2IDAuNzgyIDEuMDMxIDEuNDM4IDEuMDMxczEuMjAyLTAuNDQ1IDEuNDA2LTEuMDMxbDQuODQ0LTguNzVjMC40OTktMC45NjMgMC43ODEtMi4wNiAwLjc4MS0zLjIxODggMC0zLjg2Ni0zLjEzNC03LTctN3ptLTAuMDMxIDMuOTY4OGMxLjkzMyAwIDMuNSAxLjU2NyAzLjUgMy41cy0xLjU2NyAzLjUtMy41IDMuNS0zLjUtMS41NjctMy41LTMuNSAxLjU2Ny0zLjUgMy41LTMuNXoiIGZpbGw9IiNlNzRjM2MiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgMTAyOC40KSIvPjwvZz48L3N2Zz4="}),this.infowindow=new google.maps.InfoWindow({content:'<p>拖曳我<span class="glyphicon glyphicon-hand-up" aria-hidden="true"></span></p>'}),this.infowindow.open(this.map,this.centerMarker);var n=document.createElement("div");new e(n,this.map);n.index=1,this.map.controls[google.maps.ControlPosition.LEFT_CENTER].push(n),this.centerCircle=new google.maps.Circle({strokeColor:"#2980B9",strokeOpacity:.8,strokeWeight:2,fillColor:"#3498DB",fillOpacity:.1,map:this.map,center:a,radius:600,zIndex:999}),google.maps.event.addListener(this.centerMarker,"dragstart",function(e){this.infowindow.close()}.bind(this)),google.maps.event.addListener(this.centerMarker,"drag",function(e){this.centerCircle.setCenter(this.centerMarker.getPosition())}.bind(this)),t&&"function"==typeof t&&t()};var r=function(e,t){s.map.setCenter(new google.maps.LatLng(parseFloat(e),parseFloat(t))),s.map.setZoom(14)},l=function(e){r(e.coords.latitude,e.coords.longitude)},c=function(e){switch(e.code){case 1:console.error("錯誤!應用程式沒有權限使用定位服務!");break;case 2:console.error("錯誤!取得位址資料時發生錯誤!");break;case 3:console.error("錯誤!超過等待時間...");break;default:console.error("不明錯誤...")}},p=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(l,c):console.error("錯誤!不支援定位服務!")},u=function(e,t){e.addListener("click",function(){this.infowindow.setOptions({content:"<p>"+t+"</p>"}),this.infowindow.open(this.map,e)}.bind(s))};s.clearMap=function(e){switch(e){case"Stop":if(t){for(var s=t.length-1;s>=0;s--)t[s].setMap(null);t.length=0}break;case"GeoJson":a.forEach(function(e){a.remove(e)}),n.forEach(function(e){n.remove(e)}),i.forEach(function(e){i.remove(e)}),o.forEach(function(e){o.remove(e)})}},s.checkStop=function(e,a){if(t)for(var i=t.length-1;i>=0;i--)t[i].type===e&&t[i].setMap(a?this.map:null)}.bind(s),s.addStops=function(e){if(this.clearMap("Stop"),e.result.length>0)for(var a=e.result.length-1;a>=0;a--){var i="",n="",o=e.result[a].type;switch(o){case"M":i="#2980b9",n="捷運站: ";break;case"B":i="#16a085",n="客運站: ";break;case"T":i="#c0392b",n="火車站: ";break;case"Y":i="#f39c12",n="YouBike: "}var s=new google.maps.Marker({icon:{path:google.maps.SymbolPath.CIRCLE,fillColor:i,fillOpacity:1,scale:4.5,strokeColor:"white",strokeWeight:.5},map:this.level[o]?this.map:null,type:o,position:{lat:parseFloat(e.result[a].lat),lng:parseFloat(e.result[a].lng)}});t.push(s),u(s,n+e.result[a].name)}}.bind(s),s.addGeoJson=function(e){this.clearMap("GeoJson"),jQuery.isEmptyObject(e)||(i.setStyle({fillColor:"#2980b9",fillOpacity:.5,strokeColor:"#FFFFFF",strokeOpacity:.8,strokeWeight:.5,zIndex:991}),a.setStyle({fillColor:"#16a085",fillOpacity:.5,strokeColor:"#FFFFFF",strokeOpacity:.8,strokeWeight:.5,zIndex:995}),n.setStyle({fillColor:"#c0392b",fillOpacity:.5,strokeColor:"#FFFFFF",strokeOpacity:.8,strokeWeight:.5,zIndex:997}),o.setStyle({fillColor:"#f39c12",fillOpacity:.6,strokeColor:"#FFFFFF",strokeOpacity:.8,strokeWeight:1.2,zIndex:996}),e.result.B&&a.addGeoJson(jQuery.parseJSON(e.result.B)),e.result.M&&i.addGeoJson(jQuery.parseJSON(e.result.M)),e.result.T&&n.addGeoJson(jQuery.parseJSON(e.result.T)),e.result.Y&&o.addGeoJson(jQuery.parseJSON(e.result.Y)),a.setMap(this.map),i.setMap(this.map),n.setMap(this.map),o.setMap(this.map))}.bind(s),"function"==typeof define&&define.amd?define(s):window.GMap=s}(),function(e,t){"use strict";var a={domain:"http://demo.datarget.com.tw/TripTaipei"};a.getStops=a.domain+"/stops/getStops/#{lng}/#{lat}/#{distance}/#{type}",a.getTripArea=a.domain+"/getTripArea/GeoJson";var i={};i.getStops=function(e,i){return t.ajax({url:a.getStops.replace("#{lng}",e.longitude).replace("#{lat}",e.latitude).replace("#{distance}",e.walkDistance).replace("#{type}",e.transitType),jsonp:"callback",dataType:"jsonp",success:function(e){"0"===e.result&&swal({title:"Oops!",text:"設定條件內無大眾運輸資料."}),i&&"function"==typeof i&&i(e)},error:function(e){console.error(e)}})},i.getTripArea=function(e,i){return t.ajax({url:a.getTripArea,jsonp:"callback",dataType:"jsonp",data:{lat:e.latitude,lng:e.longitude,walkDistance:e.walkDistance,tripTime:e.tripTime,weekType:e.weekType,startTime:e.startTime,transitType:e.transitType},beforeSend:function(e){classie.removeClass(document.getElementById("pageBlock"),"hidden")},complete:function(){classie.addClass(document.getElementById("pageBlock"),"hidden")},success:function(t){jQuery.isEmptyObject(t)&&swal({title:"Sorry!",text:"設定條件內 無大眾運輸資料"}),e.result.area=t.result.BUSAREA,e.result.level=t.result.BUSSERVICE,i&&"function"==typeof i&&i(t)},error:function(e){console.error(e)}})},i.query=function(e,a){console.log(e);var i=this.getStops(e,GMap.addStops),n=this.getTripArea(e,GMap.addGeoJson);t.when.apply(t,[i,n]).then(function(){a&&"function"==typeof a&&a(e)})},"function"==typeof define&&define.amd?define(i):e.TripTaipeiService=i}(window,jQuery);